\documentclass{article}
\usepackage{amsmath}
\usepackage{graphicx} % Required for inserting images

\title{ECE584 Homework2}
\author{Yao Yijiang}
\date{September 2025}

\begin{document}

\maketitle

\section{Problem 1}
\subsection{Problem 1.1}
The prediction score for label $i$ is always the top-1 score for all $x  \in S$, which can be expressed as


\begin{equation}
    \forall x \in S,\quad y_i > y_j \quad \text{for all } j \neq i
\end{equation}
Convert it into a Satisfiability Problem Formulation:
\begin{equation}
    \exists x, \quad x \in S \land (y = f(x)) \land \left(\bigvee_{i\neq j} (y_i \leq y_j)\right)
\end{equation}
If this formula is unsatisfiable, then our requirement is verified.\\
If this formula is satisfiable, then there exists a counterexample where label $i$ is not the top-1 score.\\
\textbf{Optimization-based Formulation}
\begin{equation}
    \min_{x \in S} g(x) := \min_{j \neq i} (y_i - y_j)
\end{equation}
If $\min g(x) > 0$, then the requirement is verified.\\
If $\min g(x) \leq 0$, then the requirement is not verified.

\subsection{Problem 1.2}
The prediction score for label $j$ can never be the top-1 score for all $x \in S$, which can be expressed as
\begin{equation}
    \forall x \in S, \quad \exists k \neq i, \quad y_k > y_i
\end{equation}
Convert it into a Satisfiability Problem Formulation:
\begin{equation}
    \exists x, \quad x \in S \land \left(\bigwedge_{k\neq j} (y_i \geq y_j)\right)
\end{equation}
If this formula is unsatisfiable, then our requirement is verified\\
If this formula is satisfiable, then there exists a counterexample where label $i$ is the top-1 score.\\
\textbf{Optimization-based Formulation}
\begin{equation}
    \max_{x \in S} g(x) := \min_{j \neq k} (y_k - y_j)
\end{equation}
If $\min g(x) > 0$, then the requirement is verified.\\
If $\min g(x) \leq 0$, then the requirement is not verified.

\section{Problem 2}
\begin{align}
y = W^{(3)}(\hat{z^{(2)}}+z^{(1)})\\
\hat{z^{(2)}} = ReLU(z^{(2)})\\
z^{(2)} = W^{(2)}\hat{z^{(1)}}+b^{(2)}\\
\hat{z^{(1)}} = ReLU(z^{(1)})\\
z^{(1)} = W^{(1)}x+b^{(1)}
\end{align}
Input: $x \in \mathbf{R}^2$ and $y \in \mathbf{R}$. The input set $S = \{x|-1 \leq x_1 \leq 1, \quad -1 \leq x_2 \leq 1\}$\\
The network weights:
$$
    W^{(1)}=W^{(2)}=\begin{bmatrix}1 & -1 \\ 2 & -2\end{bmatrix}, W^{(3)}=\begin{bmatrix}-1 & 1 \end{bmatrix}, b^{(1)}=\begin{bmatrix}1 & 1 \end{bmatrix},
    b^{(2)}=\begin{bmatrix}2 & 2 \end{bmatrix}
$$
\subsection{Problem 2.1}
Use interval bound propagation(IBP) to calculate the lower bound of $y$

\begin{align}
    z^{(1)} = W^{(1)}x+b^{(1)}\\
    z^{(1)} = \begin{bmatrix}1 & -1 \\ 2 & -2\end{bmatrix}\begin{bmatrix}x_1 \\ x_2\end{bmatrix}+\begin{bmatrix}1 \\ 1 \end{bmatrix}\\
    z^{(1)} = \begin{bmatrix}x_1 - x_2 + 1 \\ 2x_1 - 2x_2 +1 \end{bmatrix}
\end{align}
Since $-1 \leq x_1 \leq 1, \quad -1 \leq x_2 \leq 1$
\begin{align}
    z^{(1)}_1 \in [-1,3],\quad z^{(2)}_2 \in [-3,5]\\
    ReLU(z^{(1)}_1) \in [0,3], \quad ReLU(z^{(1)}_1) \in [0,5]\\
\end{align}
Second layer:
\begin{align}
    z^{(2)} = W^{(2)}\hat{z^{(1)}}+b^{(2)}\\
    z^{(2)} = \begin{bmatrix}1 & -1 \\ 2 & -2\end{bmatrix}\begin{bmatrix}z^{(1)}_1 \\ z^{(1)}_2\end{bmatrix}+\begin{bmatrix}2 \\ 2 \end{bmatrix}\\
    z^{(2)} = \begin{bmatrix}z^{(1)}_1 - z^{(1)}_2 + 2 \\ 2z^{(1)}_1 - 2z^{(1)}_2 +2 \end{bmatrix}
\end{align}
Similarly,
\begin{align}
    z^{(2)}_1 \in [-3,5],\quad z^{(2)}_2 \in [-8,8]\\
    ReLU(z^{(1)}_1) \in [0,5], \quad ReLU(z^{(1)}_1) \in [0,8]
\end{align}
Therefore,
\begin{align}
y = \begin{bmatrix}-1 & 1 \end{bmatrix} (\begin{bmatrix}\hat{z^{(2)}_1} \\ \hat{z^{(2)}_2} \end{bmatrix}+\begin{bmatrix}z^{(1)}_1 \\ z^{(1)}_2 \end{bmatrix})\\
y = \begin{bmatrix}-1 & 1 \end{bmatrix} (\begin{bmatrix}[-1,3] \\ [-3,5] \end{bmatrix}+\begin{bmatrix}[0,5] \\ [0,8]\end{bmatrix})\\
y = \begin{bmatrix}-1 & 1 \end{bmatrix} \begin{bmatrix}[-1,8] \\ [-3,13]\end{bmatrix})\\
y = [-8,1] + [-3,13] = [-11,14]
\end{align}
IBP Lower Bound: $y\geq -11$


\subsection{Problem 2.2}
Use CROWN to calculate the intermediate layer lower and upper bounds of $z^{(2)}$.\\
$z^{(1)}_1 \in [-1, 3], z^{(1)}_2 \in [-3, 5]$, since $|u|\geq|l|$, $\alpha^{(1)}_1 = \alpha^{(1)}_2 = 1$\\
Upper bound:\\
\begin{equation}
    \hat{z^{(1)}_1} \leq \frac{3}{4}z^{(1)}_1 + \frac{3}{4}, \hat{z^{(1)}_2} \leq \frac{5}{8}z^{(1)}_1 + \frac{15}{8}
\end{equation}
Lower bound:\\
\begin{equation}
    \hat{z^{(1)}_1} \geq z^{(1)}_1, \hat{z^{(1)}_2} \geq z^{(1)}_2
\end{equation}
Since,
\begin{equation}
    z^{(2)} = \begin{bmatrix}z^{(1)}_1 - z^{(1)}_2 + 2 \\ 2z^{(1)}_1 - 2z^{(1)}_2 +2 \end{bmatrix}
\end{equation}
Upper bound:\\
\begin{align}
    \hat{z^{(2)}_1} \leq (\frac{3}{4}z^{(1)}_1 + \frac{3}{4}) - (z^{(1)}_2) +2 = -\frac{5}{4}x_1 + \frac{5}{4}x_2 +\frac{5}{2} \leq 5\\
    \hat{z^{(2)}_2} \leq 2(\frac{3}{4}z^{(1)}_1 + \frac{3}{4}) - 2z^{(1)}_2 +2 = -\frac{5}{2}x_1 + \frac{5}{2}x_2 +3 \leq 8
\end{align}
Lower bound:\\
\begin{align}
    \hat{z^{(2)}_1} \geq z^{(1)}_1 - (\frac{5}{8}z^{(1)}_2 + \frac{15}{8}) + 2 = -\frac{1}{4}x_1 + \frac{1}{4} + \frac{1}{2} \geq 0\\
    \hat{z^{(2)}_2} \geq 2z^{(1)}_1 - 2(\frac{5}{8}z^{(1)}_2 + \frac{5}{8}) +2 = -\frac{1}{2}x_1 + \frac{1}{2}x_2 - 1 \geq -2 
\end{align}
Therefore,
\begin{equation}
    \hat{z^{(2)}_1} \in [0,5], \hat{z^{(2)}_2} \in [-2,8]
\end{equation}

\subsection{Problem 2.3}
Using the intermediate layer bounds in step 2, calculate CROWN lower bound on the output y
\begin{equation}
    y = W^{(3)}(\hat{z^{(2)}}+z^{(1)})=-\hat{z_1^{(2)}}+\hat{z_2^{(2)}}-z_1^{(1)}+z_2^{(1)}
\end{equation}
Since $\hat{z_1^{(2)}}$ is always nonneigative,
\begin{equation}
    \hat{z_1^{(2)}}=z_1^{(2)}
\end{equation}
Since $\hat{z_2^{(2)}} \in [-2,8]$,
The upper bound:
\begin{equation}
    \hat{z_2^{(2)}}\leq\frac{4}{5}z_2^{(2)}+\frac{8}{5}
\end{equation}
The lower bound:
\begin{equation}
    \hat{z_2^{(2)}}\geq z_2^{(2)}
\end{equation}
Therefore, the lower bound for y is:
\begin{align}
    y \geq -z_1^{(2)}+z_2^{(2)}-z_1^{(1)}+z_2^{(1)}
\end{align}
Now we apply,
\begin{equation}
    \hat z^{(1)}_2 \le \tfrac58 z^{(1)}_2 + \tfrac{15}{8}
\end{equation}
Thus,
\begin{align}
y &\ge z^{(1)}_1 - \Big(\tfrac58 z^{(1)}_2 + \tfrac{15}{8}\Big) - z^{(1)}_1 + z^{(1)}_2 = \Big(1-\tfrac58\Big) z^{(1)}_2 - \tfrac{15}{8} \\
&= \tfrac38 z^{(1)}_2 - \tfrac{15}{8}.
\end{align}
Substitute $z^{(1)}_2 = 2x_1 - 2x_2 + 1$:
\begin{align}
y &\ge \tfrac38(2x_1 - 2x_2 + 1) - \tfrac{15}{8} = \tfrac34 x_1 - \tfrac34 x_2 - \tfrac32.
\end{align}
Since inputs are in  $S = \{x|-1 \leq x_1 \leq 1, \quad -1 \leq x_2 \leq 1\}$\, this linear function attains its minimum at $(x_1,x_2)=(-1,1)$, giving
\begin{equation}
    y \geq -3\
\end{equation}

\subsection{Problem 2.4}
Maximum number of $\alpha$ variables in $\alpha$-CROWN is 4. The network contains two ReLU layers with 2 neurons each, so there are $2\times 2 = 4$ ReLU units in total. In the worst case all are unstable.
\end{document}


